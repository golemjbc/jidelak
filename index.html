<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ELAI</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>

/* ===========================
   üåå Animated Gradient Background
=========================== */
body {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(
    120deg,
    #0f172a,
    #1e1b4b,
    #111827,
    #1e293b
  );
  background-size: 300% 300%;
  animation: gradientMove 18s ease infinite;
  overflow: hidden;
  perspective: 1400px;
}

@keyframes gradientMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Ambient glow */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background:
    radial-gradient(circle at 20% 30%, rgba(139,92,246,0.25), transparent 40%),
    radial-gradient(circle at 80% 70%, rgba(99,102,241,0.25), transparent 40%);
  filter: blur(120px);
  animation: floatGlow 12s ease-in-out infinite alternate;
  pointer-events: none;
}

@keyframes floatGlow {
  0% { transform: translateY(-30px); }
  100% { transform: translateY(30px); }
}

/* ===========================
   üßä App Shell
=========================== */
.app-shell {
  height: 100vh;
  display: flex;
  flex-direction: column;
  margin: 14px;
  border-radius: 32px;
  overflow: hidden;
  box-shadow: 0 0 120px rgba(139,92,246,0.25);
}

/* ===========================
   üßä Liquid Glass
=========================== */
.glass {
  position: relative;
  backdrop-filter: blur(70px) saturate(200%) contrast(110%);
  -webkit-backdrop-filter: blur(70px) saturate(200%) contrast(110%);
  background: linear-gradient(
    145deg,
    rgba(255,255,255,0.18),
    rgba(255,255,255,0.05)
  );
  border-radius: 28px;
  border: 1px solid rgba(255,255,255,0.18);
  box-shadow:
    0 50px 150px rgba(0,0,0,0.65),
    inset 0 2px 6px rgba(255,255,255,0.5),
    inset 0 -4px 14px rgba(0,0,0,0.4);
  overflow: hidden;
  transition: 0.3s ease;
}

/* moving reflection */
.glass::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background:
    radial-gradient(
      circle at var(--light-x,50%) var(--light-y,20%),
      rgba(255,255,255,0.35),
      transparent 40%
    );
  opacity: 0.5;
  pointer-events: none;
}

/* texture */
.glass::after {
  content: "";
  position: absolute;
  inset: 0;
  background:
    repeating-radial-gradient(
      circle at 50% 50%,
      rgba(255,255,255,0.02) 0px,
      rgba(255,255,255,0.02) 1px,
      transparent 1px,
      transparent 3px
    );
  opacity: 0.3;
  pointer-events: none;
}

/* ===========================
   üïí History Panel
=========================== */
.history-glass {
  margin: 0 24px;
  padding: 18px 0;
  border-radius: 32px;
  backdrop-filter: blur(90px) saturate(200%);
  background: linear-gradient(
    145deg,
    rgba(255,255,255,0.12),
    rgba(255,255,255,0.05)
  );
  box-shadow:
    0 60px 180px rgba(0,0,0,0.6),
    inset 0 2px 8px rgba(255,255,255,0.4),
    inset 0 -4px 14px rgba(0,0,0,0.5);
}

/* ===========================
   üçè Timeline
=========================== */
.timeline-wrapper {
  position: relative;
  height: 100px;
  display: flex;
  align-items: center;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  padding: 0 90px;
}

.timeline-bubble {
  scroll-snap-align: center;
  margin: 0 12px;
  padding: 10px 20px;
  border-radius: 24px;
  min-width: 140px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(60px);
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.2);
  box-shadow:
    0 25px 80px rgba(0,0,0,0.6),
    inset 0 1px 0 rgba(255,255,255,0.5);
  transform-origin: center;
  opacity: 0.3;
  transition: transform 0.25s ease, opacity 0.25s ease;
}

/* Scrollbars */
#chatSection::-webkit-scrollbar {
  width: 4px;
}
#chatSection::-webkit-scrollbar-thumb {
  background: rgba(139,92,246,0.4);
  border-radius: 10px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

</style>
</head>

<body class="flex flex-col text-zinc-200">

<div class="app-shell">

<!-- LOGO -->
<div class="flex justify-center mt-2">
  <img src="img/ELAI.png"
       class="w-full max-w-[160px] object-contain opacity-95" />
</div>

<!-- HISTORY -->
<div class="history-glass mt-4">
  <div class="timeline-wrapper" id="historySection"></div>
</div>

<!-- CHAT -->
<div id="chatSection"
     class="flex-1 overflow-y-auto px-6 py-6 space-y-4">
</div>

<!-- INPUT -->
<div class="p-4 glass flex gap-3 m-4">
  <input id="messageInput"
         type="text"
         placeholder="Tak co mi dneska naserv√≠ruje≈°?"
         class="flex-1 bg-transparent text-zinc-200 px-4 py-2 rounded-xl focus:outline-none" />
  <button onclick="sendMessage()"
          class="px-6 py-2 rounded-2xl bg-gradient-to-br from-violet-500/80 to-indigo-500/80 text-white">
    Odeslat
  </button>
</div>

</div>

<script>

/* Dynamic glass light */
document.addEventListener("mousemove", e => {
  document.querySelectorAll(".glass").forEach(el => {
    const rect = el.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * 100;
    const y = ((e.clientY - rect.top) / rect.height) * 100;
    el.style.setProperty("--light-x", x + "%");
    el.style.setProperty("--light-y", y + "%");
  });
});

</script>

<!-- ===========================
     üî• P≈ÆVODN√ç FUNKƒåN√ç JS ‚Äì BEZE ZMƒöNY
=========================== -->

<script>

const API_BASE = "https://jidelak-bng5gggscsevacbw.westeurope-01.azurewebsites.net/api";

const loadingMessages = [
"Zvy≈°uju tlak. Udr≈æ√≠≈° to?",
"Teplota roste. A j√° to miluju.",
"Je≈°tƒõ chv√≠li‚Ä¶ a praskne to.",
"Dus√≠m tƒõ napƒõt√≠m.",
"Dr≈æ se. Bude to intenzivn√≠.",
"Tlak stoup√°. V√Ωsledek bude v√Ωbu≈°n√Ω.",
"Va≈ô√≠m to tak dlouho, a≈æ to p≈ôeteƒçe.",
"M√≠ch√°m to tvrdƒõ. A bez slitov√°n√≠.",
"C√≠t√≠≈° to napƒõt√≠?",
"Je≈°tƒõ p√°r vte≈ôin‚Ä¶ a exploduje to.",
"Zah≈ô√≠v√°m to na hranici √∫nosnosti.",
"Trochu vlhka nikdy neu≈°kod√≠.",
"P≈ôiprav se. Bude to siln√©.",
"Nap√≠n√°m tƒõ schv√°lnƒõ.",
"Hraju si s tlakem, dokud to nevyst≈ôel√≠.",
"Dus√≠m tƒõ pomalu. Proto≈æe m≈Ø≈æu.",
"Je≈°tƒõ v√≠c tepla‚Ä¶ je≈°tƒõ v√≠c napƒõt√≠.",
"Bl√≠≈æ√≠m se k vrcholu v√Ωpoƒçtu.",
"Tohle bude m√≠t n√°boj.",
"Chce≈° to rychle? Sm≈Øla."
];

let loadingBubble = null;
let loadingInterval = null;

document.addEventListener("DOMContentLoaded", async () => {
  await loadHistory();
  await loadSession();
});

/* HISTORY */
async function loadHistory() {
  try {
    const res = await fetch(`${API_BASE}/history`);
    const data = await res.json();
    const history = data.history || [];
    renderHistory(filterLast14Days(history));
  } catch {}
}

function filterLast14Days(history) {
  const now = new Date();
  return history.filter(item => {
    const d = new Date(item.date);
    return (now - d) / (1000 * 60 * 60 * 24) <= 14;
  });
}

function renderHistory(items) {
  const container = document.getElementById("historySection");
  container.innerHTML = "";

  if (!items.length) return;

  const today = new Date().toISOString().slice(0,10);
  items.sort((a,b)=> new Date(a.date) - new Date(b.date));

  let lastTodayBubble = null;

  items.forEach(item => {

    const bubble = document.createElement("div");
    bubble.className = "timeline-bubble";

    if (item.date === today) {
      bubble.classList.add("today");
      lastTodayBubble = bubble;
    }

    const dateDiv = document.createElement("div");
    dateDiv.className = "timeline-bubble-date";
    dateDiv.innerText = item.date;

    const mealDiv = document.createElement("div");
    mealDiv.className = "timeline-bubble-meal";
    mealDiv.innerText = item.meal_name || item.meal_id;

    bubble.appendChild(dateDiv);
    bubble.appendChild(mealDiv);
    container.appendChild(bubble);
  });

  if (lastTodayBubble) {
    lastTodayBubble.scrollIntoView({ behavior: "smooth", inline: "center" });
  }

  container.addEventListener("scroll", () => updateTimelineScale(container));
  updateTimelineScale(container);
}

function updateTimelineScale(container) {
  const bubbles = container.querySelectorAll(".timeline-bubble");
  const center = container.scrollLeft + container.offsetWidth / 2;

  bubbles.forEach(bubble => {
    const bubbleCenter =
      bubble.offsetLeft + bubble.offsetWidth / 2;

    const distance = Math.abs(center - bubbleCenter);
    const maxDistance = container.offsetWidth / 2;

    const ratio = Math.max(0, 1 - distance / maxDistance);

    const scale = 0.7 + ratio * 0.5;
    const opacity = 0.2 + ratio * 0.8;
    const rotate = (ratio - 0.5) * 20;

    bubble.style.transform =
      `scale(${scale}) rotateY(${rotate}deg)`;
    bubble.style.opacity = opacity;
  });
}

/* SESSION + CHAT */
async function loadSession() {
  try {
    const res = await fetch(`${API_BASE}/session`);
    const data = await res.json();
    const today = new Date().toISOString().slice(0,10);
    const session = (data.sessions || []).find(s => s.date === today);
    if (session) renderChat(session.messages);
  } catch {}
}

function renderChat(messages) {
  const chat = document.getElementById("chatSection");
  chat.innerHTML = "";
  messages.forEach(msg => appendMessage(msg.role, msg.content));
  scrollChatToBottom();
}

function appendMessage(role, content) {
  const chat = document.getElementById("chatSection");
  const wrapper = document.createElement("div");
  wrapper.className = role === "user"
    ? "flex justify-end"
    : "flex justify-start";

  wrapper.innerHTML = `
    <div class="max-w-[70%] px-5 py-3 rounded-3xl ${
      role === "user"
        ? "bg-gradient-to-br from-violet-500/80 to-indigo-500/80 text-white shadow-md"
        : "glass text-zinc-200"
    } animate-[fadeIn_0.3s_ease] transition">
      ${content}
    </div>`;

  chat.appendChild(wrapper);
}

function scrollChatToBottom() {
  const chat = document.getElementById("chatSection");
  chat.scrollTop = chat.scrollHeight;
}

/* LOADING */
function showLoading() {
  const chat = document.getElementById("chatSection");

  loadingBubble = document.createElement("div");
  loadingBubble.className = "flex justify-start";

  const bubbleInner = document.createElement("div");
  bubbleInner.className = "glass px-5 py-3 rounded-3xl italic text-zinc-300";

  bubbleInner.innerText =
    loadingMessages[Math.floor(Math.random() * loadingMessages.length)];

  loadingBubble.appendChild(bubbleInner);
  chat.appendChild(loadingBubble);
  scrollChatToBottom();

  loadingInterval = setInterval(() => {
    bubbleInner.innerText =
      loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
  }, 2000);
}

function hideLoading() {
  if (loadingInterval) clearInterval(loadingInterval);
  if (loadingBubble) loadingBubble.remove();
  loadingBubble = null;
}

/* SEND */
async function sendMessage() {
  const input = document.getElementById("messageInput");
  const message = input.value.trim();
  if (!message) return;

  appendMessage("user", message);
  input.value = "";
  scrollChatToBottom();

  showLoading();

  try {
    const res = await fetch(`${API_BASE}/chat`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message })
    });

    const data = await res.json();
    hideLoading();
    appendMessage("assistant", data.reply);
    scrollChatToBottom();
    await loadHistory();
  } catch {
    hideLoading();
  }
}

document.getElementById("messageInput")
  .addEventListener("keypress", function(e) {
    if (e.key === "Enter") sendMessage();
  });

</script>

</body>
</html>
